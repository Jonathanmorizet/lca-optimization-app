<FULL COMBINED CODE OMITTED HERE FOR BREVITY IN TOOL>